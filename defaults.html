<!DOCTYPE html>
<html>

<head>
    <title>Defaults</title>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimal-ui" />
    <script>
        if (typeof module === 'object') {
            window.module = module; module = undefined;
        }
    </script>
    <!-- solve the electron-jquery conflict, style changed due to a vscode problem -->
    <script src="res/lib/jquery-3.3.1.min.js"></script>
    <script src="res/lib/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="res/lib/bootstrap.min.css" />
    <script src="res/lib/all.js"></script>
    <script src="res/lib/v4-shims.js"></script><!-- font-awesome 5 use as 4 -->
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body onpaste="return false">
    <!-- prevent people from pasting abnormal content -->
    <script src="supporter.js"></script>
    <div class="d-flex mx-auto justify-content-center align-items-center text-dark" id="main">
        <div id="controller">
            &nbsp;&nbsp;
            <a href="javascript:call('winhider')" class="small rest" id="win-hider"><i class="fa fa-sort-desc fa-fw"
                    id="winhider"></i></a><span id="no-use-space">&nbsp;&nbsp;</span>
            <a href="javascript:call('minimizer')" class="small rest"><i class="fa fa-minus fa-fw"
                    id="minimizer"></i></a>&nbsp;&nbsp;
            
            <script>
                $('#winhider').attr('title', i18n.__('winhider'));
                $('#minimizer').attr('title', i18n.__('minimizer'));
                $('#backhome').attr('title', i18n.__('defaultsbackhome'));
                if (process.platform == "darwin") $("#controller").css("display", "none");
            </script>
        </div>
        <div id="set" class="container-fluid">
            <div class="d-flex h3 rest" id="settingstitle">
                <i class="fa fa-th-list fa-fw" id="settings" aria-hidden="true"></i>
                <script>document.write(i18n.__('default1'));</script>
            </div>
            <div class="d-flex text-left" id="defaultssettingscontainer">
                <div id="itemlist">
                </div>
                <br /><br />
            </div>
            <div class="d-flex" id="defaultssettingsadd">
                <div class="container">
                    <div class="row">
                        <div class="col align-self-start text-left">
                            <a href="javascript:add()" class="text-info">
                                <script>document.write(i18n.__('add'));</script>
                            </a>
                        </div>
                        <div class="col align-self-end text-right">
                            <a href="index.html" class="small rest text-right"><i class="fa fa-chevron-left" id="backhome"></i></a>&nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let defaultArray = store.get("defaults");
        let newItem = {
            name: "new item",
            workTime: 30,
            restTime: 10,
            loops: 4
        };
        defaultArray.forEach(function (item, index, array) {
            append(item, index);
        });
        function edit(index) {
            defaultArray[index].name = $("#title" + index).val();
            if (Number($("#work-time" + index).val()) != NaN && Number($("#work-time" + index).val()) >= 2) defaultArray[index].workTime = $("#work-time" + index).val();
            else $("#work-time" + index).val(defaultArray[index].workTime);
            if (Number($("#rest-time" + index).val()) != NaN && Number($("#rest-time" + index).val()) >= 2) defaultArray[index].restTime = $("#rest-time" + index).val();
            else $("#rest-time" + index).val(defaultArray[index].restTime);
            if (Number($("#loops" + index).val()) != NaN && Number($("#loops" + index).val()) >= 1) defaultArray[index].loops = $("#loops" + index).val();
            else $("#loops" + index).val(defaultArray[index].loops);
            store.set("defaults", defaultArray);
        }
        function append(item, index) {
            $("#itemlist").append(
                "<div id='item" + index + "'>- <input name='title' id='title" + index + "' type='text' class='lead rest' maxlength='11' value='" +
                item.name + "'onchange='edit(" + index + ")' />:<br />" +
                i18n.__('working') + " <input id='work-time" + index + "' class='hotkeyset' type='number' value='" +
                item.workTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') + "<br />" +
                i18n.__('resting') + " <input id='rest-time" + index + "' class='hotkeyset' type='number' value='" +
                item.restTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') + "<br />" +
                i18n.__('looping') + " <input id='loops" + index + "' class='hotkeyset' type='number' value='" +
                item.loops + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('times') + "<br /> " +
                "<p class='text-right'><a href='javascript:erase(" + index + ")' class='work small underlined'>" + i18n.__('delete') + "</a></p> " +
                "<hr /></div>"
            );
        }
        function erase(index) {
            defaultArray.splice(index, 1);
            store.set("defaults", defaultArray);
            $("#item" + index).remove();
        }
        function add() {
            defaultArray.push(newItem);
            store.set("defaults", defaultArray);
            append(newItem, defaultArray.length - 1);
        }
    </script>
    <script src="renderer.js"></script>
</body>

</html>