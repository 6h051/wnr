<!DOCTYPE html>
<html>

<head>
    <title>wnr</title>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimal-ui" />
    <script>
        if (typeof module === 'object') {
            window.module = module; module = undefined;
        }
    </script>
    <!-- solve the electron-jquery conflict, style changed due to a vscode problem -->
    <!-- solve the electron-jquery conflict -->
    <script src="res/lib/jquery.slim.min.js"></script>
    <script src="res/lib/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="res/lib/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="res/lib/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
    <script src="supporter.js"></script>
    <div class="d-flex mx-auto justify-content-center align-items-center text-dark" id="main">
        <div id="timer" class="justify-content-center align-content-center text-center">
            <div id="floating-unhover">
                <div id="time-left" class="text-center h4 work">--</div>
                <div id="time-left-msg" class="text-center small work">
                    <script>document.write(i18n.__('min-left'));</script>
                </div>
            </div>
            <div id="floating-hover" onmouseover="hover()" onmouseleave="unhover()">
                <div class="small" id="floating-stopper">
                    <a id="stopper" href="javascript:stopper()" class="text-muted">
                        <i class="iconfont icon-pause"></i>
                    </a>
                </div>
                <div class="extreme-small" id="floating-recover">
                    <a href="javascript:recover()" class="text-muted text-left">
                        <i class="iconfont icon-expand-arrows-alt" id="recover"></i>
                    </a>
                </div>
                <div class="extreme-small" id="floating-close">
                    <a href="javascript:recover()" class="text-muted text-right">
                        <i class="iconfont icon-close" id="exit"></i>
                    </a>
                </div>
                <div class="extreme-small" id="floating-back">
                    <a href="javascript:backer()" class="text-muted text-left">
                        <i class="iconfont icon-previous" id="back-index"></i>
                    </a>
                </div>
                <div class="extreme-small" id="floating-skipper">
                    <a href="javascript:skipper()" class="text-muted text-right">
                        <i class="iconfont icon-fastforward" id="skipper"></i>
                    </a>
                </div>
            </div>
            <script>
                $('#back-index').attr('title', i18n.__('back-index'));
                $('#skipper').attr('title', i18n.__('skipper'));
                $('#recover').attr('title', i18n.__('recover'));
                $('#exit').attr('title', i18n.__('exit'));
            </script>
        </div>
    </div><!-- for things with 'work' mark, when it's resting, the color should be changed -->
    <div id="floating-bottom-bar">&nbsp;</div>
    <script>
        function hover() {
            $("#floating-unhover").css("opacity", "0");
        }
        function unhover() {
            $("#floating-unhover").css("opacity", "1");
        }

        let isWorking = true;
        function stopper() {
            ipc.send("floating-conversation", { topic: "stop" });
            if (isWorking) $("#stopper").html("<i class='iconfont icon-play' aria-hidden='true'></i>");
            else $("#stopper").html("<i class='iconfont icon-pause' aria-hidden='true'></i>");
            isWorking = !isWorking;
        }

        function skipper() {
            ipc.send("floating-conversation", { topic: "skip" });
            $("#floating-skipper").css("display", "none");
            call("floating-destroy");
        }

        function recover() {
            ipc.send("floating-conversation", { topic: "recover" });
            call("floating-destroy");
        }

        function backer() {
            ipc.send("floating-conversation", { topic: "back" });
            $("#floating-back").css("display", "none");
            call("floating-destroy");
        }

        let method = 1;
        ipc.on("floating-time-left", function (event, message) {
            $("#time-left").text(message.minute == 0 ? '<1' : message.minute);
            $('#floating-bottom-bar').css("width", message.percentage + "%");

            if (message.method == 2 && method == 1) {
                $(".work").addClass("rest");
                $(".work").removeClass("work");
                $('#floating-bottom-bar').css("background-color", "#5490ea19");
                method = 2;
            }

            if (message.method == 1 && method == 2) {
                $(".rest").addClass("work");
                $(".rest").removeClass("rest");
                $('#floating-bottom-bar').css("background-color", "#ea545419");
                method = 1;
            }
        });
    </script>
    <script src="renderer.js"></script>
</body>

</html>