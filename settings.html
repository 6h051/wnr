<!DOCTYPE html>
<html>

<head>
    <title>Settings</title>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimal-ui" />
    <script>
        if (typeof module === 'object') {
            window.module = module; module = undefined;
        }
    </script>
    <!-- solve the electron-jquery conflict, style changed due to a vscode problem -->
    <script src="res/lib/jquery-3.3.1.min.js"></script>
    <script src="res/lib/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="res/lib/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="res/lib/all.js"></script>
    <script src="res/lib/v4-shims.js"></script><!-- font-awesome 5 use as 4 -->
</head>

<body>
    <script src="supporter.js"></script>
    <div id="controller">
        <a href="javascript:window.close()" class="small rest"><i class="fa fa-times fa-fw" id="exitsave"></i></a>
        <script>
            $('#exitsave').attr('title', i18n.__('exitsave'));
            if (process.platform == "darwin") $("#controller").css("display", "none");
        </script>
    </div>
    <div class="d-flex h3 rest" id="settingstitle">
        <i class="fa fa-cog fa-fw" id="settings" aria-hidden="true"></i>
        <script>document.write(i18n.__('settings'));</script>
    </div>
    <div class="d-flex" id="settingscontainer">
        <div id="settings" class="text-left">
            <p class="lead"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>
                <script>document.write(i18n.__('timeset'));</script>
            </p>
            <hr />
            <div class="align-content-center form-text">
                <span class="text-muted small">
                    <script>document.write(i18n.__('timesetdeleted'));</script>
                </span>
            </div>
            <br />
            <p class="lead"><i class="fa fa-superpowers" aria-hidden="true"></i>
                <script>document.write(i18n.__('defaultsset'));</script>
            </p>
            <hr />
            <div class="align-content-center form-text">
                <div class="align-self-start text-left small text-muted">
                    <script>document.write(i18n.__('defaulttip'));</script>
                </div>
                <div class="d-flex text-left">
                    <div id="itemlist">
                        <ul id="itemlist-ul"></ul>
                    </div>
                    <br /><br />
                </div>
                <div class="align-self-start text-left">
                    <a href="javascript:add()" class="text-info">
                        <script>document.write(i18n.__('add'));</script>
                    </a>
                </div>
            </div>
            <br />
            <p class="lead"><i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                <script>document.write(i18n.__('globalset'));</script>
            </p>
            <hr />
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('langset'));</script></label>
                <input id="lang-set" type="checkbox" onchange="langset()" />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('langtip'));</script>
                    <br /><b>
                        <script>document.write(i18n.__('autorestarttip'));</script>
                    </b>
                </span>
            </div>
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('soundnotify'));</script></label>
                <input id="sound-set" type="checkbox" onchange="soundset()" checked />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('soundtip'));</script>
                </span>
            </div>
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('alwaysontop'));</script></label>
                <input id="top-set" type="checkbox" onchange="topset()" />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('alwaystip'));</script>
                    <br /><b>
                        <script>document.write(i18n.__('autorestarttip'));</script>
                    </b>
                </span>
            </div>
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('autostart'));</script></label>
                <input id="autostart-set" type="checkbox" onchange="autostartset()" />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('autotip'));</script>
                </span>
            </div>
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('autocheck'));</script></label>
                <input id="autocheck-set" type="checkbox" onchange="autocheckset()" />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('checktip'));</script>
                </span>
            </div>
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('isalarmtipon'));</script></label>
                <input id="alarmtip-set" type="checkbox" onchange="alarmtipset()" />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('isalarmtipontip'));</script>
                </span>
            </div>
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('isonemintipon'));</script></label>
                <input id="onemintip-set" type="checkbox" onchange="onemintipset()" />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('isonemintipontip'));</script>
                </span>
            </div>
            <div class="align-content-center form-text">
                <label>
                    <script>document.write(i18n.__('isautostarttaskon'));</script></label>
                <input id="autostarttask-set" type="checkbox" onchange="autostarttaskset()" />
                <br /><span class="text-muted small">
                    <script>document.write(i18n.__('isautostarttaskontip'));</script>
                </span>
            </div>
            <br />
            <p class="lead"><i class="fa fa-ellipsis-h fa-fw" aria-hidden="true"></i>
                <script>document.write(i18n.__('otherthings'));</script>
            </p>
            <hr />
            <div class="text-muted small">
                <li>
                    <a href="javascript:updatechecker(2)" class="rest">
                        <span id="manually">
                            <script>document.write(i18n.__('manuallycheck'));</script>
                        </span>
                    </a>&nbsp;
                    <b>
                        <script>document.write(i18n.__('checker1') + i18n.__('v') + require("./package.json").version + i18n.__('checker2'))</script>
                    </b>
                </li>
                <li id="hotkey-tip">
                    <script>document.write(i18n.__('hotkeytip'));</script>
                    <b>Ctrl+Shift+Alt+<input id="hotkey1-set" class="hotkeyset" type="text" maxlength="1"
                            onchange="hotkey1set()" />.<br />
                        <script>document.write(i18n.__('hotkeyusage'));</script>
                    </b>
                </li>
                <li id="hotkey2-tip">
                    <script>document.write(i18n.__('hotkey2tip'));</script>
                    <b>Ctrl+Shift+Alt+<input id="hotkey2-set" class="hotkeyset" type="text" maxlength="1"
                            onchange="hotkey2set()" />.<br />
                        <script>document.write(i18n.__('hotkey2usage'));</script>
                    </b>
                </li>
                <li>
                    <a href="javascript:call('deleteall')" class="rest">
                        <script>document.write(i18n.__('deleteall'));</script>
                    </a>
                    <b>
                        <script>document.write(i18n.__('autorestarttip'));</script>
                    </b>
                </li>
                <li>
                    <script>document.write(i18n.__('snoretip'));</script>
                </li>
            </div>
        </div>
    </div>
    <script>
        if (process.platform == 'darwin') {
            $("#hotkey-tip").css("display", "none");
        }
    </script>
    <script src="updater.js"></script>
    <script>
        //defaults settings
        let defaultArray = store.get("predefined-tasks");
        let newItem = {
            name: "new item",
            workTime: 30,
            restTime: 10,
            loops: 4,
            focusWhenWorking: false,
            focusWhenResting: false
        };
        defaultArray.forEach(function (item, index, array) {
            append(item, index);
        });
        setAsDefault(store.get("default-task"));
        function edit(index) {
            defaultArray[index].name = $("#title" + index).val();
            if (Number($("#work-time" + index).val()) != NaN && Number($("#work-time" + index).val()) >= 2) defaultArray[index].workTime = $("#work-time" + index).val();
            else $("#work-time" + index).val(defaultArray[index].workTime);
            if (Number($("#rest-time" + index).val()) != NaN && Number($("#rest-time" + index).val()) >= 2) defaultArray[index].restTime = $("#rest-time" + index).val();
            else $("#rest-time" + index).val(defaultArray[index].restTime);
            if (Number($("#loops" + index).val()) != NaN && Number($("#loops" + index).val()) >= 1) defaultArray[index].loops = $("#loops" + index).val();
            else $("#loops" + index).val(defaultArray[index].loops);
            if (document.getElementById("focuswhenworking" + index).checked) defaultArray[index].focusWhenWorking = true;
            else defaultArray[index].focusWhenWorking = false;
            if (document.getElementById("focuswhenresting" + index).checked) defaultArray[index].focusWhenResting = true;
            else defaultArray[index].focusWhenResting = false;
            store.set("predefined-tasks", defaultArray);
        }
        function append(item, index) {
            $("#itemlist-ul").append(
                "<li id='item" + index + "'> <input name='title' id='title" + index + "' type='text' class='lead rest' maxlength='11' value='" +
                item.name + "'onchange='edit(" + index + ")' />: <br />" +
                i18n.__('working') + " <input id='work-time" + index + "' class='hotkeyset' type='number' value='" +
                item.workTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') + " | " +
                i18n.__('resting') + " <input id='rest-time" + index + "' class='hotkeyset' type='number' value='" +
                item.restTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') + " | " +
                i18n.__('looping') + " <input id='loops" + index + "' class='hotkeyset' type='number' value='" +
                item.loops + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('times') +
                "<br />" + i18n.__('focuswhenworking') + " <input id='focuswhenworking" + index + "' class='focuser' type='checkbox' onchange='edit(" + index + ")' /> | " +
                i18n.__('focuswhenresting') + " <input id='focuswhenresting" + index + "' class='focuser' type='checkbox' onchange='edit(" + index + ")' />" +
                "<span id='setasdefault-container" + index + "'> | <a href='javascript:setAsDefault(" + index + ")'>" + i18n.__('setasdefault') + "</a></span>" +
                "<br /><span id='deleter" + index + "'><a href='javascript:erase(" + index + ")' class='work small underlined'>" + i18n.__('delete') + "</a></span> " +
                "<hr /></li>"
            );
            if (item.focusWhenWorking) document.getElementById("focuswhenworking" + index).checked = true;
            else document.getElementById("focuswhenworking" + index).checked = false;
            if (item.focusWhenResting) document.getElementById("focuswhenresting" + index).checked = true;
            else document.getElementById("focuswhenresting" + index).checked = false;
        }
        function erase(index) {
            defaultArray.splice(index, 1);
            store.set("predefined-tasks", defaultArray);
            $("#item" + index).remove();
        }
        function add() {
            defaultArray.push(newItem);
            store.set("predefined-tasks", defaultArray);
            append(newItem, defaultArray.length - 1);
        }
        function setAsDefault(index) {
            $("#deleter" + store.get("default-task")).css("display", "inline");
            $("#setasdefault-container" + store.get("default-task")).css("display", "inline");
            $('#title' + store.get("default-task")).removeClass("work");
            $('#title' + store.get("default-task")).addClass("rest");
            store.set("default-task", index);
            $("#deleter" + index).css("display", "none");
            $("#setasdefault-container" + index).css("display", "none");
            $('#title' + index).removeClass("rest");
            $('#title' + index).addClass("work");
        }

        //global settings
        if (store.get("i18n") != undefined) {
            if (store.get("i18n") == 'en') document.getElementById("lang-set").checked = true;
            else document.getElementById("lang-set").checked = false;
        }
        function langset() {
            if (document.getElementById("lang-set").checked == true) store.set("i18n", 'en');
            else store.set("i18n", 'zh');
            var t = setTimeout("call('relauncher')", 500);
        }
        if (store.get("sound") != undefined) {
            if (store.get("sound")) document.getElementById("sound-set").checked = true;
            else document.getElementById("sound-set").checked = false;
        }
        function soundset() {
            if (document.getElementById("sound-set").checked == true) store.set("sound", true);
            else store.set("sound", false);
        }
        if (store.get("top") != undefined) {
            if (store.get("top") == true) document.getElementById("top-set").checked = true;
            else document.getElementById("top-set").checked = false;
        }
        function topset() {
            if (document.getElementById("top-set").checked == true) store.set("top", true);
            else store.set("top", false);
            var t = setTimeout("call('relauncher')", 500);
        }
        if (store.get("autostart") == true) document.getElementById("autostart-set").checked = true;
        else document.getElementById("autostart-set").checked = false;
        function autostartset() {
            var AutoLaunch = require('auto-launch');
            var wnrLauncher = new AutoLaunch({ name: 'wnr' });
            if (document.getElementById("autostart-set").checked == true) {
                store.set("autostart", true);
                wnrLauncher.isEnabled()
                    .then(function (isEnabled) {
                        if (isEnabled) {
                            return;
                        }
                        wnrLauncher.enable();
                    })
            }
            else {
                store.set("autostart", false);
                wnrLauncher.isEnabled()
                    .then(function (isEnabled) {
                        if (isEnabled) {
                            wnrLauncher.disable();
                        }
                        return;
                    })
            }
        }
        if (store.get("autocheck") != false) document.getElementById("autocheck-set").checked = true;
        else document.getElementById("autocheck-set").checked = false;
        function autocheckset() {
            if (document.getElementById("autocheck-set").checked == true) store.set("autocheck", true);
            else store.set("autocheck", false);
        }
        if (store.get("alarmtip") != false) document.getElementById("alarmtip-set").checked = true;
        else document.getElementById("alarmtip-set").checked = false;
        function alarmtipset() {
            if (document.getElementById("alarmtip-set").checked == true) store.set("alarmtip", true);
            else store.set("alarmtip", false);
        }
        if (store.get("onemintip") != false) document.getElementById("onemintip-set").checked = true;
        else document.getElementById("onemintip-set").checked = false;
        function onemintipset() {
            if (document.getElementById("onemintip-set").checked == true) store.set("onemintip", true);
            else store.set("onemintip", false);
        }
        if (store.get("autostarttask") == true) document.getElementById("autostarttask-set").checked = true;
        else document.getElementById("autostarttask-set").checked = false;
        function autostarttaskset() {
            if (document.getElementById("autostarttask-set").checked == true) store.set("autostarttask", true);
            else store.set("autostarttask", false);
        }

        //other things
        $("#hotkey1-set").val(store.get("hotkey1").toUpperCase());
        function hotkey1set() {
            if ($("#hotkey1-set").val() != null && $("#hotkey1-set").val()) {
                if ($("#hotkey1-set").val().toUpperCase() != store.get('hotkey2')) {
                    $("#hotkey1-set").val($("#hotkey1-set").val().toUpperCase());
                    store.set("hotkey1", $("#hotkey1-set").val());
                    var t = setTimeout("call('relauncher')", 500);
                } else $("#hotkey1-set").val(store.get("hotkey1"));
            } else {
                store.set("hotkey1", 'W');
                var t = setTimeout("call('relauncher')", 500);
            }
        }
        $("#hotkey2-set").val(store.get("hotkey2").toUpperCase());
        function hotkey2set() {
            if ($("#hotkey2-set").val() != null && $("#hotkey2-set").val()) {
                if ($("#hotkey2-set").val().toUpperCase() != store.get('hotkey1')) {
                    $("#hotkey2-set").val($("#hotkey2-set").val().toUpperCase());
                    store.set("hotkey2", $("#hotkey2-set").val());
                    var t = setTimeout("call('relauncher')", 500);
                } else $("#hotkey2-set").val(store.get("hotkey2"));
            } else {
                store.set("hotkey2", 'S');
                var t = setTimeout("call('relauncher')", 500);
            }
        }
    </script>
    <script src="renderer.js"></script>
</body>

</html>