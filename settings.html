<!DOCTYPE html>
<html>

<head>
    <title>Settings</title>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimal-ui" />
    <script>
        if (typeof module === 'object') {
            window.module = module; module = undefined;
        }
    </script>
    <!-- solve the electron-jquery conflict, style changed due to a vscode problem -->
    <link rel="preload" as="style" href="loader.css" onload="this.rel='stylesheet'">
    <!-- loader style preload -->
    <script src="res/lib/jquery.slim.min.js"></script>
    <script src="res/lib/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="res/lib/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="res/lib/all.js"></script>
    <script src="res/lib/v4-shims.js"></script><!-- font-awesome 5 use as 4 -->
</head>

<body>
    <!-- loader -->
    <div id="loader-wrapper">
        <div id="loader-work"></div>
        <div class="loader-section section-left"></div>
        <div class="loader-section section-right"></div>
    </div>
    <script>
        window.onload = function () {
            $("body").addClass("loaded");
            setTimeout(function () { $('#loader-wrapper').remove() }, 1000);
        } 
    </script>

    <script src="supporter.js"></script>
    <div id="controller">
        <a href="javascript:window.close()" class="small rest"><i class="fa fa-times fa-fw" id="exit-and-save"></i></a>
        <script>
            $('#exit-and-save').attr('title', i18n.__('exit-and-save'));
            if (process.platform == "darwin") $("#controller").css("display", "none");
        </script>
    </div>
    <div class="d-flex h3 rest" id="settings-title">
        <i class="fa fa-cog fa-fw" aria-hidden="true"></i>
        <script>document.write(i18n.__('settings'));</script>
    </div>
    <div class="d-flex" id="settings-container">
        <div class="text-left">
            <!-- 1. time settings (formally, deleted) -->
            <!--<p class="lead"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>
                <script>document.write(i18n.__('time-settings'));</script>
                &nbsp;<a href="javascript:getHelp('settings/1-time-settings')" class="small rest"><i
                        class="fa fa-question get-help"></i></a>
            </p>
            <hr />
            <div class="align-content-center form-text">
                <span class="text-muted small">
                    <script>document.write(i18n.__('times-settings-deleted-tip'));</script>
                </span>
            </div>-->
            <div id="predefined-tasks-anchor" class="should-lock">
                <!-- 2. predefined tasks settings -->
                <br />
                <p class="lead"><i class="fa fa-superpowers" aria-hidden="true"></i>
                    <script>document.write(i18n.__('predefined-tasks-settings'));</script>
                    &nbsp;<a href="javascript:getHelp('settings/2-predefined-tasks-settings')" class="small rest"><i
                            class="fa fa-question get-help"></i></a>
                </p>
                <hr />
                <div class="align-content-center form-text">
                    <div class="align-self-start text-left small text-muted">
                        <script>document.write(i18n.__('predefined-tasks-settings-tip'));</script>
                    </div>
                    <div class="d-flex text-left">
                        <div id="itemlist">
                            <ul id="itemlist-ul"></ul>
                        </div>
                        <br /><br />
                    </div>
                    <div class="align-self-start text-left">
                        <a href="javascript:add()" class="text-info">
                            <script>document.write(i18n.__('add'));</script>
                        </a>
                    </div>
                </div>
                <br />
            </div>

            <!-- 3. global settings -->
            <div class="should-lock">
                <p class="lead"><i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <script>document.write(i18n.__('global-settings'));</script>
                    &nbsp;<a href="javascript:getHelp('settings/3-global-settings')" class="small rest"><i
                            class="fa fa-question get-help"></i></a>
                </p>
                <hr />
                <!-- language setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('language-setting'));</script></label>
                    <input id="language-setting" type="checkbox" onchange="languageSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('language-setting-tip'));</script>
                        <br /><b>
                            <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                        </b>
                    </span>
                </div>
                <!-- notifying sound setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('sound-to-notify-setting'));</script></label>
                    <input id="notifying-sound-setting" type="checkbox" onchange="notifyingSoundSetting()" checked />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('sound-to-notify-setting-tip'));</script>
                    </span>
                </div>
                <!-- always-on-top setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('always-on-top-setting'));</script></label>
                    <input id="always-on-top-setting" type="checkbox" onchange="alwaysOnTopSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('always-on-top-setting-tip'));</script>
                        <br /><b>
                            <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                        </b>
                    </span>
                </div>
                <!-- wnr auto-start setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('auto-start-setting'));</script></label>
                    <input id="auto-start-setting" type="checkbox" onchange="autoStartSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('auto-start-setting-tip'));</script>
                    </span>
                </div>
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('auto-check-update-setting'));</script></label>
                    <input id="auto-check-update-setting" type="checkbox" onchange="autoCheckSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('auto-check-update-setting-tip'));</script>
                    </span>
                </div>
                <!-- alarm for not using setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('is-alarm-for-not-using-wnr-on'));</script></label>
                    <input id="alarm-for-not-using-wnr-dialog-box-title-setting" type="checkbox"
                        onchange="alarmForNotUsingSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('is-alarm-for-not-using-wnr-on-tip'));</script>
                    </span>
                </div>
                <!-- one minute left setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('is-one-min-left-notification-on'));</script></label>
                    <input id="one-min-left-notification-setting" type="checkbox"
                        onchange="oneMinLeftNotificationSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('is-one-min-left-notification-on-tip'));</script>
                    </span>
                </div>
                <!-- auto start the default task setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('is-auto-start-task-setting-on'));</script></label>
                    <input id="auto-start-task-setting" type="checkbox" onchange="autoStartDefaultTaskSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('is-auto-start-task-setting-on-tip'));</script>
                    </span>
                </div>
                <!-- local time shown when timer setting -->
                <div class="align-content-center form-text">
                    <label>
                        <script>document.write(i18n.__('is-local-time-setting-on'));</script></label>
                    <input id="local-time-setting" type="checkbox" onchange="localTimeSetting()" />
                    <br /><span class="text-muted small">
                        <script>document.write(i18n.__('is-local-time-setting-on-tip'));</script>
                    </span>
                </div>
                <br />
            </div>

            <!-- 4. lock mode settings -->
            <div id="locker-anchor">
                <p class="lead"><i class="fa fa-lock" aria-hidden="true"></i>
                    <script>document.write(i18n.__('locker-settings'));</script>
                    &nbsp;<a href="javascript:getHelp('settings/4-lock-mode-settings')" class="small rest"><i
                            class="fa fa-question get-help"></i></a>
                </p>
                <hr />
                <div class="align-content-center form-text">
                    <span class="text-muted small">
                        <script>
                            document.write(i18n.__('locker-settings-tip') + '<b>'
                                + (store.get('islocked') ? i18n.__('on') : i18n.__('off')) + '</b>' + i18n.__('period-symbol'));
                        </script>
                    </span>
                    <br />
                    <input name="passcode-locker" id="passcode-locker" type="password" maxlength="11"
                        onkeydown="if(event.keyCode == 13) lock($('#passcode-locker').val(), $('#passcode-locker-again').val());" />
                    <br />
                    <input name="passcode-locker-again" id="passcode-locker-again" type="password" maxlength="11"
                        onkeydown="if(event.keyCode == 13) lock($('#passcode-locker').val(), $('#passcode-locker-again').val());" />
                    <br />
                    <span class="text-muted small">
                        <script>
                            $('#passcode-locker').attr('placeholder', i18n.__('locker-settings-input'));
                            $('#passcode-locker-again').attr('placeholder', i18n.__('locker-settings-input-again'));
                            document.write(store.get('islocked') ? i18n.__('locker-settings-input-tip-lock-mode-on') : i18n.__('locker-settings-input-tip-lock-mode-off'));
                        </script>
                    </span>
                </div>
                <br />
            </div>

            <!-- 5. other things -->
            <div class="should-lock">
                <p class="lead"><i class="fa fa-ellipsis-h fa-fw" aria-hidden="true"></i>
                    <script>document.write(i18n.__('other-things'));</script>
                    &nbsp;<a href="javascript:getHelp('settings/5-other-things')" class="small rest"><i
                            class="fa fa-question get-help"></i></a>
                </p>
                <hr />
                <div class="text-muted small">
                    <!-- manually check for update -->
                    <li>
                        <a href="javascript:updateChecker(2)" class="rest">
                            <span id="manually">
                                <script>document.write(i18n.__('manually-check-for-update'));</script>
                            </span>
                        </a>&nbsp;
                        <b>
                            <script>document.write(i18n.__('manually-check-for-update-tip-1') + i18n.__('v') + require("./package.json").version + i18n.__('manually-check-for-update-tip-2'))</script>
                        </b>
                    </li>
                    <!-- hotkey for show or hide -->
                    <li id="hotkey-tip">
                        <script>document.write(i18n.__('hotkey-for-show-or-hide-setting'));</script>
                        <b>Ctrl+Shift+Alt+<input id="hotkey-for-show-or-hide-setting" class="hotkeyset" type="text"
                                maxlength="1" onchange="hotkeyForShowOrHideSetting()" />.<br />
                            <script>document.write(i18n.__('hotkey-for-show-or-hide-setting-tip'));</script>
                        </b>
                    </li>
                    <!-- hotkey for start or stop the task -->
                    <li id="hotkey2-tip">
                        <script>document.write(i18n.__('hotkey-for-start-or-stop-setting'));</script>
                        <b>Ctrl+Shift+Alt+<input id="hotkey-for-start-or-stop-setting" class="hotkeyset" type="text"
                                maxlength="1" onchange="hotkeyForStartOrStopSetting()" />.<br />
                            <script>document.write(i18n.__('hotkey-for-start-or-stop-setting-tip'));</script>
                        </b>
                    </li>
                    <!-- delete all the data -->
                    <li>
                        <a href="javascript:call('delete-all-data')" class="rest">
                            <script>document.write(i18n.__('delete-all-data'));</script>
                        </a>
                        <b>
                            <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                        </b>
                    </li>
                    <!-- tip for notification-sending -->
                    <li>
                        <script>document.write(i18n.__('notification-sending-tip'));</script>
                    </li>
                </div>
            </div>
        </div>
    </div>
    <script>
        if (process.platform == 'darwin') $("#hotkey-tip").css("display", "none");
        $(".get-help").attr('title', i18n.__('helper'));
    </script>
    <script src="updater.js"></script>
    <script>
        var timeOut = null;//temporary variable
        //defaults settings
        let defaultArray = store.get("predefined-tasks");
        let newItem = {
            name: "new item",
            workTime: 30,
            restTime: 10,
            loops: 4,
            focusWhenWorking: false,
            focusWhenResting: false
        };
        defaultArray.forEach(function (item, index, array) {
            append(item, index);
        });
        setAsDefault(store.get("default-task"));
        function edit(index) {
            defaultArray[index].name = $("#title" + index).val();
            if (Number($("#work-time" + index).val()) != NaN && Number($("#work-time" + index).val()) >= 2) defaultArray[index].workTime = $("#work-time" + index).val();
            else $("#work-time" + index).val(defaultArray[index].workTime);
            if (Number($("#rest-time" + index).val()) != NaN && Number($("#rest-time" + index).val()) >= 2) defaultArray[index].restTime = $("#rest-time" + index).val();
            else $("#rest-time" + index).val(defaultArray[index].restTime);
            if (Number($("#loops" + index).val()) != NaN && Number($("#loops" + index).val()) >= 1) defaultArray[index].loops = $("#loops" + index).val();
            else $("#loops" + index).val(defaultArray[index].loops);
            if (document.getElementById("focus-when-working" + index).checked) defaultArray[index].focusWhenWorking = true;
            else defaultArray[index].focusWhenWorking = false;
            if (document.getElementById("focus-when-resting" + index).checked) defaultArray[index].focusWhenResting = true;
            else defaultArray[index].focusWhenResting = false;
            store.set("predefined-tasks", defaultArray);
        }
        function append(item, index) {
            $("#itemlist-ul").append(
                "<li id='item" + index + "'> <input name='title' id='title" + index + "' type='text' class='lead rest' maxlength='11' value='" +
                item.name + "'onchange='edit(" + index + ")' />: <br />" +
                i18n.__('working') + " <input id='work-time" + index + "' class='hotkeyset' type='number' value='" +
                item.workTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') + " | " +
                i18n.__('resting') + " <input id='rest-time" + index + "' class='hotkeyset' type='number' value='" +
                item.restTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') + " | " +
                i18n.__('looping') + " <input id='loops" + index + "' class='hotkeyset' type='number' value='" +
                item.loops + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('times') +
                "<br />" + i18n.__('focus-when-working') + " <input id='focus-when-working" + index + "' class='focuser' type='checkbox' onchange='edit(" + index + ")' /> | " +
                i18n.__('focus-when-resting') + " <input id='focus-when-resting" + index + "' class='focuser' type='checkbox' onchange='edit(" + index + ")' />" +
                "<span id='set-as-default-task-container" + index + "'> | <a class='rest' href='javascript:setAsDefault(" + index + ")'>" + i18n.__('set-as-default-task') + "</a></span>" +
                "<br /><span id='deleter" + index + "'><a href='javascript:erase(" + index + ")' class='work small underlined'>" + i18n.__('delete') + "</a></span> " +
                "<hr /></li>"
            );
            if (item.focusWhenWorking) document.getElementById("focus-when-working" + index).checked = true;
            else document.getElementById("focus-when-working" + index).checked = false;
            if (item.focusWhenResting) document.getElementById("focus-when-resting" + index).checked = true;
            else document.getElementById("focus-when-resting" + index).checked = false;
        }
        function erase(index) {
            defaultArray.splice(index, 1);
            store.set("predefined-tasks", defaultArray);
            $("#item" + index).remove();
        }
        function add() {
            defaultArray.push(newItem);
            store.set("predefined-tasks", defaultArray);
            append(newItem, defaultArray.length - 1);
        }
        function setAsDefault(index) {
            $("#deleter" + store.get("default-task")).css("display", "inline");
            $("#set-as-default-task-container" + store.get("default-task")).css("display", "inline");
            $('#title' + store.get("default-task")).removeClass("work");
            $('#title' + store.get("default-task")).addClass("rest");
            store.set("default-task", index);
            $("#deleter" + index).css("display", "none");
            $("#set-as-default-task-container" + index).css("display", "none");
            $('#title' + index).removeClass("rest");
            $('#title' + index).addClass("work");
        }

        //global settings
        if (store.get("i18n") != undefined) {
            if (store.get("i18n") == 'en') document.getElementById("language-setting").checked = true;
            else document.getElementById("language-setting").checked = false;
        }
        function languageSetting() {
            if (document.getElementById("language-setting").checked == true) store.set("i18n", 'en');
            else store.set("i18n", 'zh');
            timeOut = setTimeout("call('relauncher')", 500);
        }
        if (store.get("sound") != undefined) {
            if (store.get("sound")) document.getElementById("notifying-sound-setting").checked = true;
            else document.getElementById("notifying-sound-setting").checked = false;
        }
        function notifyingSoundSetting() {
            if (document.getElementById("notifying-sound-setting").checked == true) store.set("sound", true);
            else store.set("sound", false);
        }
        if (store.get("top") != undefined) {
            if (store.get("top") == true) document.getElementById("always-on-top-setting").checked = true;
            else document.getElementById("always-on-top-setting").checked = false;
        }
        function alwaysOnTopSetting() {
            if (document.getElementById("always-on-top-setting").checked == true) store.set("top", true);
            else store.set("top", false);
            timeOut = setTimeout("call('relauncher')", 500);
        }
        if (store.get("autostart") == true) document.getElementById("auto-start-setting").checked = true;
        else document.getElementById("auto-start-setting").checked = false;
        function autoStartSetting() {
            var AutoLaunch = require('auto-launch');
            var wnrLauncher = new AutoLaunch({ name: 'wnr' });
            if (document.getElementById("auto-start-setting").checked == true) {
                store.set("autostart", true);
                wnrLauncher.isEnabled()
                    .then(function (isEnabled) {
                        if (isEnabled) {
                            return;
                        }
                        wnrLauncher.enable();
                    })
            }
            else {
                store.set("autostart", false);
                wnrLauncher.isEnabled()
                    .then(function (isEnabled) {
                        if (isEnabled) {
                            wnrLauncher.disable();
                        }
                        return;
                    })
            }
        }
        if (store.get("autocheck") != false) document.getElementById("auto-check-update-setting").checked = true;
        else document.getElementById("auto-check-update-setting").checked = false;
        function autoCheckSetting() {
            if (document.getElementById("auto-check-update-setting").checked == true) store.set("autocheck", true);
            else store.set("autocheck", false);
        }
        if (store.get("alarmtip") != false) document.getElementById("alarm-for-not-using-wnr-dialog-box-title-setting").checked = true;
        else document.getElementById("alarm-for-not-using-wnr-dialog-box-title-setting").checked = false;
        function alarmForNotUsingSetting() {
            if (document.getElementById("alarm-for-not-using-wnr-dialog-box-title-setting").checked == true) store.set("alarmtip", true);
            else store.set("alarmtip", false);
        }
        if (store.get("onemintip") != false) document.getElementById("one-min-left-notification-setting").checked = true;
        else document.getElementById("one-min-left-notification-setting").checked = false;
        function oneMinLeftNotificationSetting() {
            if (document.getElementById("one-min-left-notification-setting").checked == true) store.set("onemintip", true);
            else store.set("onemintip", false);
        }
        if (store.get("autostarttask") == true) document.getElementById("auto-start-task-setting").checked = true;
        else document.getElementById("auto-start-task-setting").checked = false;
        function autoStartDefaultTaskSetting() {
            if (document.getElementById("auto-start-task-setting").checked == true) store.set("autostarttask", true);
            else store.set("autostarttask", false);
        }
        if (store.get("localtime") != false) document.getElementById("local-time-setting").checked = true;
        else document.getElementById("local-time-setting").checked = false;
        function localTimeSetting() {
            if (document.getElementById("local-time-setting").checked != false) store.set("localtime", true);
            else store.set("localtime", false);
        }

        //lock mode settings
        function lock(passcode, again) {
            var md5 = require('md5');
            if (passcode == "" || again == "") ipc.send("locker-passcode", 'empty');
            else
                if (!store.get('islocked')) {
                    if (passcode == again) {
                        store.set('lockerpasscode', md5(passcode));
                        store.set('islocked', true);
                        ipc.send("locker-passcode", 'lock-mode-on');
                        window.close();
                    } else ipc.send("locker-passcode", 'not-same-password');
                } else {
                    if (passcode == again) {
                        if (passcode == store.get('lockerpasscode') || md5(passcode) == store.get('lockerpasscode')) {
                            store.set('islocked', false);
                            ipc.send("locker-passcode", 'lock-mode-off');
                            window.close();
                        } else ipc.send("locker-passcode", 'wrong-passcode');
                    } else ipc.send("locker-passcode", 'not-same-password');
                }
        }

        //other things
        $("#hotkey-for-show-or-hide-setting").val(store.get("hotkey1").toUpperCase());
        function hotkeyForShowOrHideSetting() {
            if ($("#hotkey-for-show-or-hide-setting").val() != null && $("#hotkey-for-show-or-hide-setting").val()) {
                if ($("#hotkey-for-show-or-hide-setting").val().toUpperCase() != store.get('hotkey2')) {
                    $("#hotkey-for-show-or-hide-setting").val($("#hotkey-for-show-or-hide-setting").val().toUpperCase());
                    store.set("hotkey1", $("#hotkey-for-show-or-hide-setting").val());
                    timeOut = setTimeout("call('relauncher')", 500);
                } else $("#hotkey-for-show-or-hide-setting").val(store.get("hotkey1"));
            } else {
                store.set("hotkey1", 'W');
                timeOut = setTimeout("call('relauncher')", 500);
            }
        }
        $("#hotkey-for-start-or-stop-setting").val(store.get("hotkey2").toUpperCase());
        function hotkeyForStartOrStopSetting() {
            if ($("#hotkey-for-start-or-stop-setting").val() != null && $("#hotkey-for-start-or-stop-setting").val()) {
                if ($("#hotkey-for-start-or-stop-setting").val().toUpperCase() != store.get('hotkey1')) {
                    $("#hotkey-for-start-or-stop-setting").val($("#hotkey-for-start-or-stop-setting").val().toUpperCase());
                    store.set("hotkey2", $("#hotkey-for-start-or-stop-setting").val());
                    timeOut = setTimeout("call('relauncher')", 500);
                } else $("#hotkey-for-start-or-stop-setting").val(store.get("hotkey2"));
            } else {
                store.set("hotkey2", 'S');
                timeOut = setTimeout("call('relauncher')", 500);
            }
        }
    </script>
    <script src="renderer.js"></script>
</body>

</html>