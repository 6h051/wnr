<!DOCTYPE html>
<html>

<head>
    <title>Settings</title>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimal-ui" />
    <script>
        if (typeof module === 'object') {
            window.module = module; module = undefined;
        }
    </script>
    <!-- solve the electron-jquery conflict, style changed due to a vscode problem -->
    <link rel="preload" as="style" href="loader.css" onload="this.rel='stylesheet'">
    <!-- loader style preload -->
    <script src="res/lib/jquery.slim.min.js"></script>
    <script src="res/lib/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="res/lib/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="res/lib/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
    <!-- loader -->
    <div id="loader-wrapper">
        <div id="loader"></div>
        <div class="loader-section section-left"></div>
        <div class="loader-section section-right"></div>
    </div>
    <script>
        window.onload = function () {
            $("body").addClass("loaded");
            setTimeout(function () { $('#loader-wrapper').remove() }, 1000);
        } 
    </script>

    <script src="supporter.js"></script>
    <div id="controller">
        <a href="javascript:window.close()" class="small rest"><i class="iconfont icon-close"
                id="exit-and-save"></i></a>
        <script>
            $('#exit-and-save').attr('title', i18n.__('exit-and-save'));
            if (process.platform == "darwin") $("#controller").css("display", "none");
        </script>
    </div>
    <div class="d-flex h3 rest" id="settings-title">
        <script>document.write(i18n.__('settings'));</script>
    </div>

    <div id="settings-sidebar">
        <div class="settings-sidebar-block lead should-lock" id="predefined-tasks-sidebar"
            onclick="settingsGoto('predefined-tasks')">
            <div class="container-fluid">
                <div class="row align-items-start">
                    <div class="col-3 text-center">
                        <i class="iconfont icon-bolt" aria-hidden="true"></i>
                    </div>
                    <div class="col-9">
                        <script>document.write(i18n.__('predefined-tasks-settings'));</script>
                    </div>
                </div>
            </div>
        </div>
        <div class="settings-sidebar-block lead should-lock" id="languages-sidebar" onclick="settingsGoto('languages')">
            <div class="container-fluid">
                <div class="row align-items-start">
                    <div class="col-3 text-center">
                        <i class="iconfont icon-translation" aria-hidden="true"></i>
                    </div>
                    <div class="col-9">
                        <script>document.write(i18n.__('languages'));</script>
                    </div>
                </div>
            </div>
        </div>
        <div class="settings-sidebar-block lead should-lock" id="global-settings-sidebar"
            onclick="settingsGoto('global-settings')">
            <div class="container-fluid">
                <div class="row align-items-start">
                    <div class="col-3 text-center">
                        <i class="iconfont" id="global-settings-sidebar-icon" aria-hidden="true"></i>
                    </div>
                    <div class="col-9">
                        <script>document.write(i18n.__('global-settings'));</script>
                    </div>
                </div>
            </div>
            <script>
                if (isChinese) $("#global-settings-sidebar-icon").addClass("icon-globe-asia");
                else $("#global-settings-sidebar-icon").addClass("icon-globe-europe");
            </script>
        </div>
        <div class="settings-sidebar-block lead" id="locker-sidebar" onclick="settingsGoto('locker')">
            <div class="container-fluid">
                <div class="row align-items-start">
                    <div class="col-3 text-center">
                        <i class="iconfont icon-lock" aria-hidden="true"></i>
                    </div>
                    <div class="col-9">
                        <script>document.write(i18n.__('locker-settings'));</script>
                    </div>
                </div>
            </div>
        </div>
        <div class="settings-sidebar-block lead should-lock" id="other-things-sidebar"
            onclick="settingsGoto('other-things')">
            <div class="container-fluid">
                <div class="row align-items-start">
                    <div class="col-3 text-center">
                        <i class="iconfont icon-more" aria-hidden="true"></i>
                    </div>
                    <div class="col-9">
                        <script>document.write(i18n.__('other-things'));</script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex" id="settings-container">
        <div class="text-left">
            <!-- 1. predefined tasks settings -->
            <div id="predefined-tasks" class="should-lock">
                <div class="align-content-center form-text">
                    <label class="align-self-start text-left" type="none">
                        <script>document.write(i18n.__('predefined-tasks-settings-tip'));</script>
                    </label>
                    <div class="d-flex text-left">
                        <div id="itemlist">
                            <ul id="itemlist-ul"></ul>
                        </div>
                        <br /><br />
                    </div>
                    <div class="align-self-start text-left">
                        <a href="javascript:add()" class="text-info underlined">
                            <script>document.write(i18n.__('add'));</script>
                        </a>
                    </div>
                </div>
            </div>

            <!-- 2. languages -->
            <div id="languages" class="should-lock">
                <div class="align-content-center form-text">
                    <label class="align-self-start text-left" type="none">
                        <script>document.write(i18n.__('language-setting-tip'));</script>
                    </label>
                    <br />
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                            id="language-dropdown-button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                        </button>
                        <div class="dropdown-menu" id="language-select" aria-labelledby="language-dropdown-button">
                        </div>
                    </div>
                    <span class="text-muted small">
                        <script>
                            document.write(i18n.__('language-contribute-tip-part-1')
                                + "<a href=\"javascript:require('electron').shell.openExternal('https://github.com/RoderickQiu/wnr/blob/master/locales/README.md')\">"
                                + i18n.__('language-contribute-tip-part-2')
                                + "</a>"
                                + i18n.__('feedback-tip-part-4'));
                        </script>
                        <br />
                        <b>
                            <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                        </b>
                    </span>
                </div>
            </div>

            <!-- 3. global settings -->
            <div id="global-settings" class="should-lock container">
                <p class="text-muted small text-right">
                    <script>document.write(i18n.__('notification-settings'));</script>
                </p>
                <!-- notifying sound setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="notifying-sound-setting" type="checkbox" onchange="notifyingSoundSetting()"
                            checked />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('sound-to-notify-setting'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('sound-to-notify-setting-tip'));</script>
                        </span>
                    </div>
                </div>
                <br />
                <!-- alarm for not using setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="alarm-for-not-using-wnr-dialog-box-title-setting" type="checkbox"
                            onchange="alarmForNotUsingSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('is-alarm-for-not-using-wnr-on'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('is-alarm-for-not-using-wnr-on-tip'));</script>
                        </span>
                    </div>
                </div>
                <br />
                <!-- one minute left setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="one-min-left-notification-setting" type="checkbox"
                            onchange="oneMinLeftNotificationSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('is-one-min-left-notification-on'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('is-one-min-left-notification-on-tip'));</script>
                        </span>
                    </div>
                </div>
                <hr />
                <p class="text-muted small text-right">
                    <script>document.write(i18n.__('timer-settings'));</script>
                </p>
                <!-- auto start the default task setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="auto-start-task-setting" type="checkbox" onchange="autoStartDefaultTaskSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('is-auto-start-task-setting-on'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('is-auto-start-task-setting-on-tip'));</script>
                        </span>
                    </div>
                </div>
                <br />
                <!-- local time shown when timer setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="local-time-setting" type="checkbox" onchange="localTimeSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('is-local-time-setting-on'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('is-local-time-setting-on-tip'));</script>
                        </span>
                    </div>
                </div>
                <br />
                <!-- infinity mode setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="infinity-mode-setting" type="checkbox" onchange="infinityModeSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('is-infinity-mode-setting-on'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('is-infinity-mode-setting-on-tip'));</script>
                        </span>
                    </div>
                </div>
                <br />
                <!-- always-on-top setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="always-on-top-setting" type="checkbox" onchange="alwaysOnTopSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('always-on-top-setting'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('always-on-top-setting-tip'));</script>
                            <b>
                                <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                            </b>
                        </span>
                    </div>
                </div>
                <hr />
                <p class="text-muted small text-right">
                    <script>document.write(i18n.__('general-settings'));</script>
                </p>
                <!-- wnr auto-start setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="auto-start-setting" type="checkbox" onchange="autoStartSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('auto-start-setting'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('auto-start-setting-tip'));</script>
                        </span>
                    </div>
                </div>
                <br />
                <!-- auto update check setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="auto-check-update-setting" type="checkbox" onchange="autoCheckSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('auto-check-update-setting'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>document.write(i18n.__('auto-check-update-setting-tip'));</script>
                        </span>
                    </div>
                </div>
                <br />
                <!-- data sent setting -->
                <div class="row">
                    <div class="col-1 text-center">
                        <input id="data-sent-setting" type="checkbox" onchange="dataSentSetting()" />
                    </div>
                    <div class="col-11 text-left">
                        <label>
                            <script>document.write(i18n.__('should-sent'));</script>
                        </label>
                        <br />
                        <span class="text-muted small">
                            <script>
                                document.write(i18n.__('should-sent-msg-part-1') + i18n.__('should-sent-msg-part-2')
                                    + "<a href=\"javascript:require('electron').shell.openExternal('https://tongji.baidu.com/web/help/article?id=330&type=0')\">"
                                    + i18n.__('should-sent-msg-part-3') + "</a>" + i18n.__('period-symbol'));
                            </script>
                        </span>
                    </div>
                </div>
                <br />
            </div>

            <!-- 4. lock mode settings -->
            <div id="locker">
                <div class="align-content-center form-text">
                    <label>
                        <script>
                            document.write(i18n.__('locker-settings-tip-part-1') + i18n.__('locker-settings-tip-part-2') + '<span class="font-weight-bold rest">'
                                + (store.get('islocked') ? i18n.__('on') : i18n.__('off')) + '</span>' + i18n.__('period-symbol'));
                        </script>
                    </label>
                    <br />
                    <input name="passcode-locker" id="passcode-locker" type="password" maxlength="11"
                        onkeydown="if(event.keyCode == 13) lock($('#passcode-locker').val(), $('#passcode-locker-again').val());" />
                    <br />
                    <input name="passcode-locker-again" id="passcode-locker-again" type="password" maxlength="11"
                        onkeydown="if(event.keyCode == 13) lock($('#passcode-locker').val(), $('#passcode-locker-again').val());" />
                    <br />
                    <span class="text-muted small">
                        <script>
                            $('#passcode-locker').attr('placeholder', i18n.__('locker-settings-input'));
                            $('#passcode-locker-again').attr('placeholder', i18n.__('locker-settings-input-again'));
                            document.write(store.get('islocked') ? i18n.__('locker-settings-input-tip-lock-mode-on') : i18n.__('locker-settings-input-tip-lock-mode-off'));
                        </script>
                        <br />
                        <b>
                            <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                        </b>
                    </span>
                </div>
                <br />
            </div>

            <!-- 5. other things -->
            <div id="other-things" class="should-lock">
                <ul>
                    <!-- manually check for update -->
                    <li>
                        <script>document.write(i18n.__('manually-check-for-update-msg'));</script>
                        <p class="small text-muted">
                            <a href="javascript:updateChecker(2)" class="rest underlined">
                                <span id="manually">
                                    <script>document.write(i18n.__('manually-check-for-update'));</script>
                                </span>
                            </a>&nbsp;
                            <b>
                                <script>document.write(i18n.__('manually-check-for-update-tip-1') + i18n.__('v') + require("./package.json").version + i18n.__('manually-check-for-update-tip-2'))</script>
                            </b>
                        </p>
                    </li>
                    <!-- hotkey for show or hide -->
                    <li id="hotkey-tip">
                        <script>document.write(i18n.__('hotkey-for-show-or-hide-setting'));</script>
                        <p class="small text-muted">
                            <input name="hotkey-1" id="hotkey-1" type="text" readonly onclick="keyDownCapturer('1')"
                                onblur="keyDownTriggerRemover()" ime-mode="disabled" />
                            <br />
                            <script>document.write(i18n.__('hotkey-for-show-or-hide-setting-tip')); </script>
                        </p>
                    </li>
                    <!-- hotkey for start or stop the task -->
                    <li id="hotkey2-tip">
                        <script>document.write(i18n.__('hotkey-for-start-or-stop-setting'));</script>
                        <p class="small text-muted">
                            <input name="hotkey-2" id="hotkey-2" type="text" readonly onclick="keyDownCapturer('2')"
                                onblur="keyDownTriggerRemover()" ime-mode="disabled" />
                            <br />
                            <script>document.write(i18n.__('hotkey-for-start-or-stop-setting-tip')); </script>
                        </p>
                    </li>
                    <!-- delete all the data -->
                    <li>
                        <script>document.write(i18n.__('delete-all-data-msg'));</script>
                        <p class="small text-muted">
                            <a href="javascript:call('delete-all-data')" class="rest underlined">
                                <script>document.write(i18n.__('delete-all-data') + i18n.__('period-symbol'));</script>
                            </a>&nbsp;
                            <b>
                                <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                            </b>
                        </p>
                    </li>
                    <!-- settings backup -->
                    <li>
                        <script>document.write(i18n.__('settings-backup-msg'));</script>
                        <p class="small text-muted">
                            <a href="javascript:settingsBackup()" class="rest underlined">
                                <script>document.write(i18n.__('copy') + i18n.__('period-symbol'));</script>
                            </a>&nbsp;
                            <script>document.write(i18n.__('settings-backup-tip'));</script>
                        </p>
                    </li>
                    <!-- settings import -->
                    <li>
                        <script>document.write(i18n.__('settings-import-msg'));</script>
                        <br />
                        <input name="settings-import-input" id="settings-import-input" type="password"
                            onkeydown="if(event.keyCode == 13) settingsImport($('#settings-import-input').val());" />
                        <script> $('#settings-import-input').attr('placeholder', i18n.__('settings-import'));</script>
                        <p class="small text-muted">
                            <script>document.write(i18n.__('settings-import-tip'));</script>
                            <b>
                                <script>document.write(i18n.__('need-to-restart-now-tip'));</script>
                            </b>
                        </p>
                    </li>
                    <!-- tip for notification-sending -->
                    <li>
                        <script>document.write(i18n.__('notification-sending-tip-msg'));</script>
                        <p class="small text-muted">
                            <script>
                                document.write(i18n.__('notification-sending-tip'));
                            </script>
                        </p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="get-help" id="settings-helper">
        <a class="small rest">
            <i class="iconfont icon-info" id="helper"></i>
        </a>
    </div>

    <!-- right click context menu methods -->
    <script>
        window.addEventListener('contextmenu', function (e) {
            e.preventDefault();
            ipc.send("settings-win-context-menu");
        }, false);//right-click menu

        let isLong = false;
        let touch, x, y;
        $("#settings-container").on({
            touchstart: function (e) {
                isLong = false;
                touch = e.touches[0];
                x = Number(touch.pageX);
                y = Number(touch.pageY);//get axis

                timeOutEvent = setTimeout(function () {
                    isLong = true;
                    ipc.send("settings-win-context-menu", { x: x, y: y });
                }, 500);
            },
            touchmove: function () {
                clearTimeout(timeOutEvent);
                timeOutEvent = 0;
            },
            touchend: function (e) {
                clearTimeout(timeOutEvent);
            }
        });//long-touch menu
    </script>

    <script>
        if (process.platform == 'darwin') $("#hotkey-tip").css("display", "none");
        $(".get-help").attr('title', i18n.__('helper'));

        settingsGoto(store.get("settings-goto"));

        function settingsGoto(mask) {
            if (mask == "locker") {
                $("#settings-helper a").attr("href", "javascript:getHelp('settings/4-lock-mode-settings')");

                $("#locker-sidebar").addClass("settings-sidebar-block-highlighted");
                $("#predefined-tasks-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#other-things-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#global-settings-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#languages-sidebar").removeClass("settings-sidebar-block-highlighted");

                $("#locker").css("display", "block");
                $("#predefined-tasks").css("display", "none");
                $("#global-settings").css("display", "none");
                $("#other-things").css("display", "none");
                $("#languages").css("display", "none");
            } else if ((mask == "predefined-tasks" || mask == "" || mask == null) && (!store.get('islocked'))) {
                $("#settings-helper a").attr("href", "javascript:getHelp('settings/2-predefined-tasks-settings')");

                $("#locker-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#predefined-tasks-sidebar").addClass("settings-sidebar-block-highlighted");
                $("#other-things-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#global-settings-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#languages-sidebar").removeClass("settings-sidebar-block-highlighted");

                $("#locker").css("display", "none");
                $("#predefined-tasks").css("display", "block");
                $("#global-settings").css("display", "none");
                $("#other-things").css("display", "none");
                $("#languages").css("display", "none");
            } else if (mask == "languages" && (!store.get('islocked'))) {
                $("#settings-helper a").attr("href", "javascript:getHelp('settings/6-languages')");

                $("#locker-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#predefined-tasks-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#other-things-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#global-settings-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#languages-sidebar").addClass("settings-sidebar-block-highlighted");

                $("#locker").css("display", "none");
                $("#predefined-tasks").css("display", "none");
                $("#global-settings").css("display", "none");
                $("#other-things").css("display", "none");
                $("#languages").css("display", "block");
            } else if ((mask == "global-settings" || mask == "normal") && (!store.get('islocked'))) {
                $("#settings-helper a").attr("href", "javascript:getHelp('settings/3-global-settings')");

                $("#locker-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#predefined-tasks-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#other-things-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#global-settings-sidebar").addClass("settings-sidebar-block-highlighted");
                $("#languages-sidebar").removeClass("settings-sidebar-block-highlighted");

                $("#locker").css("display", "none");
                $("#predefined-tasks").css("display", "none");
                $("#global-settings").css("display", "block");
                $("#other-things").css("display", "none");
                $("#languages").css("display", "none");
            } else if (mask == "other-things" && (!store.get('islocked'))) {
                $("#settings-helper a").attr("href", "javascript:getHelp('settings/5-other-things')");

                $("#locker-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#predefined-tasks-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#other-things-sidebar").addClass("settings-sidebar-block-highlighted");
                $("#global-settings-sidebar").removeClass("settings-sidebar-block-highlighted");
                $("#languages-sidebar").removeClass("settings-sidebar-block-highlighted");

                $("#locker").css("display", "none");
                $("#predefined-tasks").css("display", "none");
                $("#global-settings").css("display", "none");
                $("#other-things").css("display", "block");
                $("#languages").css("display", "none");
            }
        }
    </script>
    <script src="updater.js"></script>
    <script>
        var timeOut = null;//temporary variable

        //defaults settings
        let defaultArray = store.get("predefined-tasks");
        let newItem = {
            name: "new item",
            workTime: 30,
            restTime: 10,
            loops: 4,
            focusWhenWorking: false,
            focusWhenResting: false
        };
        defaultArray.forEach(function (item, index, array) {
            append(item, index);
        });
        setAsDefault(store.get("default-task"));
        function edit(index) {
            defaultArray[index].name = $("#title" + index).val();
            if (Number($("#work-time" + index).val()) != NaN && Number($("#work-time" + index).val()) >= 2) defaultArray[index].workTime = $("#work-time" + index).val();
            else $("#work-time" + index).val(defaultArray[index].workTime);
            if (Number($("#rest-time" + index).val()) != NaN && Number($("#rest-time" + index).val()) >= 2) defaultArray[index].restTime = $("#rest-time" + index).val();
            else $("#rest-time" + index).val(defaultArray[index].restTime);
            if (Number($("#loops" + index).val()) != NaN && Number($("#loops" + index).val()) >= 1) defaultArray[index].loops = $("#loops" + index).val();
            else $("#loops" + index).val(defaultArray[index].loops);
            if (document.getElementById("focus-when-working" + index).checked) defaultArray[index].focusWhenWorking = true;
            else defaultArray[index].focusWhenWorking = false;
            if (document.getElementById("focus-when-resting" + index).checked) defaultArray[index].focusWhenResting = true;
            else defaultArray[index].focusWhenResting = false;
            store.set("predefined-tasks", defaultArray);
        }
        function append(item, index) {
            $("#itemlist-ul").append(
                "<li id='item" + index + "'> <input name='title' id='title" + index + "' type='text' class='lead rest' maxlength='15' value='" +
                item.name + "'onchange='edit(" + index + ")' /> <br /><div class='text-muted small'>" +
                i18n.__('predefined-tasks-settings-tip-part-1') + " <input id='work-time" + index + "' class='hotkeyset' type='number' value='" +
                item.workTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') +
                i18n.__('predefined-tasks-settings-tip-part-2') + " <input id='rest-time" + index + "' class='hotkeyset' type='number' value='" +
                item.restTime + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('min') +
                i18n.__('predefined-tasks-settings-tip-part-3') + " <input id='loops" + index + "' class='hotkeyset' type='number' value='" +
                item.loops + "'onchange='edit(" + index + ")' oninput='if (value.length > 2) value = value.slice(0, 2)' style='ime-mode:Disabled' /> " +
                i18n.__('times') +
                "<br />" + i18n.__('focus-when-working') + " <input id='focus-when-working" + index + "' type='checkbox' onchange='edit(" + index + ")' /> | " +
                i18n.__('focus-when-resting') + " <input id='focus-when-resting" + index + "' type='checkbox' onchange='edit(" + index + ")' />\
                <br /><span id='set-as-default-task-container" + index + "'><a class='rest underlined' href='javascript:setAsDefault(" + index + ")'>" + i18n.__('set-as-default-task') + "</a> | </span>\
                <span id='deleter" + index + "'><a href='javascript:erase(" + index + ")' class='work underlined'>" + i18n.__('delete') + "</a></span>\
                </div><hr /></li>"
            );
            if (item.focusWhenWorking) document.getElementById("focus-when-working" + index).checked = true;
            else document.getElementById("focus-when-working" + index).checked = false;
            if (item.focusWhenResting) document.getElementById("focus-when-resting" + index).checked = true;
            else document.getElementById("focus-when-resting" + index).checked = false;
        }
        function erase(index) {
            defaultArray.splice(index, 1);
            store.set("predefined-tasks", defaultArray);
            $("#item" + index).remove();
        }
        function add() {
            defaultArray.push(newItem);
            store.set("predefined-tasks", defaultArray);
            append(newItem, defaultArray.length - 1);
        }
        function setAsDefault(index) {
            $("#deleter" + store.get("default-task")).css("display", "inline");
            $("#set-as-default-task-container" + store.get("default-task")).css("display", "inline");
            $('#title' + store.get("default-task")).removeClass("work");
            $('#title' + store.get("default-task")).addClass("rest");
            store.set("default-task", index);
            $("#deleter" + index).css("display", "none");
            $("#set-as-default-task-container" + index).css("display", "none");
            $('#title' + index).removeClass("rest");
            $('#title' + index).addClass("work");
        }

        //language settings
        for (i in languageList) {
            $("#language-select").append("\
            <a class='dropdown-item' href='javascript:languageSetting(\"" + languageList[i] + "\")'>"
                + languageNameList[i] + "</a>");
            if (store.get("i18n") == languageList[i]) {
                $("#language-dropdown-button").text(languageNameList[i]);
            }
        }
        function languageSetting(val) {
            if (store.get('i18n') != val) {
                try {
                    store.set("i18n", val);
                } catch (e) {
                    console.log(e);
                }
                timeOut = setTimeout("call('relauncher')", 500);
            }
        }

        //global settings
        if (store.get("sound") != undefined) {
            if (store.get("sound")) document.getElementById("notifying-sound-setting").checked = true;
            else document.getElementById("notifying-sound-setting").checked = false;
        }
        function notifyingSoundSetting() {
            if (document.getElementById("notifying-sound-setting").checked == true) store.set("sound", true);
            else store.set("sound", false);
        }
        if (store.get("top") != undefined) {
            if (store.get("top") == true) document.getElementById("always-on-top-setting").checked = true;
            else document.getElementById("always-on-top-setting").checked = false;
        }
        function alwaysOnTopSetting() {
            if (document.getElementById("always-on-top-setting").checked == true) store.set("top", true);
            else store.set("top", false);
            timeOut = setTimeout("call('relauncher')", 500);
        }
        var AutoLaunch = require('auto-launch');
        var wnrLauncher = new AutoLaunch({ name: 'wnr' });
        wnrLauncher.isEnabled()
            .then(function (isEnabled) {
                if (isEnabled) {
                    document.getElementById("auto-start-setting").checked = true;
                } else {
                    document.getElementById("auto-start-setting").checked = false;
                }
            }).catch(function (error) {
                ipc.send("alert", i18n.__('without-permission-part-1') + ((process.platform == "darwin") ? i18n.__('without-permission-part-2') : ""));
            })
        function autoStartSetting() {
            if (document.getElementById("auto-start-setting").checked == true) {
                store.set("autostart", true);
                wnrLauncher.isEnabled()
                    .then(function (isEnabled) {
                        if (isEnabled) {
                            return;
                        }
                        wnrLauncher.enable();
                    }).catch(function (error) {
                        store.set("autostart", false);
                        document.getElementById("auto-start-setting").checked = false;
                        ipc.send("alert", i18n.__('without-permission-part-1') + ((process.platform == "darwin") ? i18n.__('without-permission-part-2') : ""));
                    })
            }
            else {
                store.set("autostart", false);
                wnrLauncher.isEnabled()
                    .then(function (isEnabled) {
                        if (isEnabled) {
                            wnrLauncher.disable();
                        }
                        return;
                    }).catch(function (error) {
                        store.set("autostart", true);
                        document.getElementById("auto-start-setting").checked = true;
                        ipc.send("alert", i18n.__('without-permission-part-1') + ((process.platform == "darwin") ? i18n.__('without-permission-part-2') : ""));
                    })
            }
        }
        if (store.get("autocheck") != false) document.getElementById("auto-check-update-setting").checked = true;
        else document.getElementById("auto-check-update-setting").checked = false;
        function autoCheckSetting() {
            if (document.getElementById("auto-check-update-setting").checked == true) store.set("autocheck", true);
            else store.set("autocheck", false);
        }
        if (store.get("alarmtip") != false) document.getElementById("alarm-for-not-using-wnr-dialog-box-title-setting").checked = true;
        else document.getElementById("alarm-for-not-using-wnr-dialog-box-title-setting").checked = false;
        function alarmForNotUsingSetting() {
            if (document.getElementById("alarm-for-not-using-wnr-dialog-box-title-setting").checked == true) store.set("alarmtip", true);
            else store.set("alarmtip", false);
        }
        if (store.get("onemintip") != false) document.getElementById("one-min-left-notification-setting").checked = true;
        else document.getElementById("one-min-left-notification-setting").checked = false;
        function oneMinLeftNotificationSetting() {
            if (document.getElementById("one-min-left-notification-setting").checked == true) store.set("onemintip", true);
            else store.set("onemintip", false);
        }
        if (store.get("autostarttask") == true) document.getElementById("auto-start-task-setting").checked = true;
        else document.getElementById("auto-start-task-setting").checked = false;
        function autoStartDefaultTaskSetting() {
            if (document.getElementById("auto-start-task-setting").checked == true) store.set("autostarttask", true);
            else store.set("autostarttask", false);
        }
        if (store.get("localtime") != false) document.getElementById("local-time-setting").checked = true;
        else document.getElementById("local-time-setting").checked = false;
        function localTimeSetting() {
            if (document.getElementById("local-time-setting").checked != false) store.set("localtime", true);
            else store.set("localtime", false);
        }
        if (store.get("infinity") == true) document.getElementById("infinity-mode-setting").checked = true;
        else document.getElementById("infinity-mode-setting").checked = false;
        function infinityModeSetting() {
            if (document.getElementById("infinity-mode-setting").checked == true) store.set("infinity", true);
            else store.set("infinity", false);
        }
        if (store.get("should-sent") != false) document.getElementById("data-sent-setting").checked = true;
        else document.getElementById("data-sent-setting").checked = false;
        function dataSentSetting() {
            if (document.getElementById("data-sent-setting").checked != false) store.set("should-sent", true);
            else store.set("should-sent", false);
        }

        //lock mode settings
        function lock(passcode, again) {
            try {
                var md5 = require('crypto-js/md5');
                if (passcode == "" || again == "") ipc.send("locker-passcode", 'empty');
                else
                    if (!store.get('islocked')) {
                        if (passcode == again) {
                            store.set('lockerpasscode', md5(passcode).toString());
                            store.set('islocked', true);
                            ipc.send("locker-passcode", 'lock-mode-on');
                            window.close();
                        } else ipc.send("locker-passcode", 'not-same-password');
                    } else {
                        if (passcode == again) {
                            if (passcode == store.get('lockerpasscode') || md5(passcode).toString() == store.get('lockerpasscode')) {
                                store.set('islocked', false);
                                ipc.send("locker-passcode", 'lock-mode-off');
                                window.close();
                            } else ipc.send("locker-passcode", 'wrong-passcode');
                        } else ipc.send("locker-passcode", 'not-same-password');
                    }
            } catch (e) {
                console.log(e);
            }
        }

        //other things
        let hotkeyTo = "", keyDownGet = "";;
        $("#hotkey-1").val(store.get("hotkey1"));
        $("#hotkey-2").val(store.get("hotkey2"));
        function keyDownCapturer(to) {
            hotkeyTo = to;
            document.addEventListener('keydown', KeyDownTrigger, false);
        }

        function isTagNude(tag) {
            if (tag.indexOf('Control') == -1 && tag.indexOf('Shift') == -1
                && tag.indexOf('Alt') == -1 && tag.indexOf('Command') == -1 && tag.indexOf('Win') == -1)
                return true;
            else return false;
        }

        function KeyDownTrigger(event) {
            event.preventDefault();
            keyDownGet = "";

            const keyName = event.key;

            if (keyName === 'Control' || keyName === 'Alt' || keyName === 'Shift' || keyName === 'Meta') return;

            if (event.metaKey) keyDownGet += (process.platform == "darwin") ? "Command + " : "";
            if (event.ctrlKey) keyDownGet += "Control + ";
            if (event.shiftKey) keyDownGet += "Shift + ";
            if (event.altKey) keyDownGet += "Alt + ";
            if (keyName) keyDownGet += keyName.toUpperCase();
            if (keyName.indexOf("Unidentified") == -1 && keyName.indexOf("Dead") == -1 && keyName.indexOf("PROCESS") == -1) {
                if (isTagNude(keyDownGet)) keyDownGet = cmdOrCtrl._('long', 'pascal') + " + Shift + Alt + " + keyDownGet;
                $("#hotkey-" + hotkeyTo).val(keyDownGet);
                ipc.send("global-shortcut-set", { type: hotkeyTo, before: store.get("hotkey" + hotkeyTo), to: keyDownGet });
            } else keyDownGet = "";
        }

        function keyDownTriggerRemover() {
            document.removeEventListener('keydown', KeyDownTrigger, false);
        }

        // settings backup & import
        var aes = require("crypto-js/aes");
        var encoding = require("crypto-js/enc-utf8");
        var copyToClipboard = require("copy-to-clipboard");
        function settingsBackup() {
            var cipherText = aes.encrypt(JSON.stringify(store.store), String(process.env.SETTING_BACKUP_KEY));
            copyToClipboard(cipherText.toString());
            ipc.send("alert", i18n.__('copied'));
        }
        function settingsImport(token) {
            var bytes = aes.decrypt(token, String(process.env.SETTING_BACKUP_KEY));
            var isAllRight = true;
            try {
                var decryptedData = JSON.parse(bytes.toString(encoding));
                store.set(decryptedData);
            } catch (error) {
                if (error instanceof SyntaxError) {
                    ipc.send("alert", i18n.__('settings-import-error'))
                    isAllRight = false;
                }
            }
            setTimeout(function () {
                if (isAllRight) call('relauncher');
            }, 500);
        }
    </script>
    <script src="renderer.js"></script>
</body>

</html>